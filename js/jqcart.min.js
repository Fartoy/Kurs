(function(d) {


	var a, k, g = "",
		n = 0,
		p = !1,
		l = d('<div class="cart"><span class="cart__left"> Cart </span><span class="cart__right">0</span></div>'),
		h = {
			buttons: ".add_item",
			cartLabel: "body",
			visibleLabel: !1,
			openByAdding: !1,
			handler: "/",
			currency: "$"
		},
		c = {
			init: function(b) {
				h = d.extend(h, b);
				a = c.getStorage();
				if (null !== a && Object.keys(a).length) {
					for (var e in a) a.hasOwnProperty(e) && (n += a[e].count);
					p = !0
				}
				l.prependTo(h.cartLabel)[p || h.visibleLabel ? "show" : "hide"]().on("click", c.openCart).find(".cart__right").text(n);
				d(document).on("click", h.buttons, c.addToCart).on("click", ".jqcart-layout", function(b) {
					b.target === this && c.hideCart()
				}).on("click", ".jqcart-incr", c.changeAmount).on("input keyup", ".jqcart-amount", c.changeAmount).on("click", ".jqcart-del-item", c.delFromCart).on("submit", ".jqcart-orderform", c.sendOrder).on("reset", ".jqcart-orderform", c.hideCart);
				return !1
			},
			addToCart: function(b) {
				b.preventDefault();
				k = d(this).data();
				if ("undefined" === typeof k.id) return console.log("\u041e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 ID \u0442\u043e\u0432\u0430\u0440\u0430"), !1;
				a = c.getStorage() || {};
				a.hasOwnProperty(k.id) ? a[k.id].count++ : (k.count = 1, a[k.id] = k);
				c.setStorage(a);
				c.changeTotalCnt(1);
				l.show();
				h.openByAdding && c.openCart();
				return !1
			},
			delFromCart: function() {
				var b = d(this).closest(".jqcart-tr"),
					e = b.data("id");
				a = c.getStorage();
				c.changeTotalCnt(-a[e].count);
				delete a[e];
				c.setStorage(a);
				b.remove();
				c.recalcSum();
				return !1
			},
			changeAmount: function() {
				var b = d(this),
					e = b.hasClass("jqcart-amount"),
					g = +(e ? b.val() : b.data("incr")),
					f = b.closest(".jqcart-tr").data("id");
				a = c.getStorage();
				a[f].count = e ? isNaN(g) || 1 > g ? 1 : g : a[f].count + g;
				1 > a[f].count && (a[f].count = 1);
				e ? b.val(a[f].count) : b.siblings("input").val(a[f].count);
				c.setStorage(a);
				c.recalcSum();
				return !1
			},
			recalcSum: function() {
				var b = 0,
					e, a = 0,
					f = 0;
				d(".jqcart-tr").each(function() {
					e = +d(".jqcart-amount", this).val();
					a = Math.ceil(e * d(".jqcart-price", this).text() * 100) / 100;
					d(".jqcart-sum", this).html(a + " " + "$");
					b = Math.ceil(100 * (b + a)) / 100;
					f += e
				});
				d(".jqcart-subtotal strong").text(b);
				d(".cart__right").text(f);
				0 >= f && (c.hideCart(), h.visibleLabel || l.hide());
				return !1
			},
			changeTotalCnt: function(b) {
				var e = d(".cart__right");
				e.text(+e.text() + b);
				return !1
			},
			openCart: function() {
				var b = 0;
				a = c.getStorage();
				g = '<p class="jqcart-cart-title">Cart </span></p><div class="jqcart-table-wrapper"><div class="jqcart-manage-order"><div class="jqcart-thead"><div>ID</div><div></div><div> Name </div><div> Price for one </div><div> Count </div><div> Amount </div><div></div></div>';
				var e;
				for (e in a)
					if (a.hasOwnProperty(e)) {
						var k = Math.ceil(a[e].count * a[e].price * 100) / 100;
						b = Math.ceil(100 * (b + k)) / 100;
						g += '<div class="jqcart-tr" data-id="' + a[e].id + '">';
						g += '<div class="jqcart-small-td">' + a[e].id + "</div>";
						g += '<div class="jqcart-small-td jqcart-item-img"><img class="cart__img" src="' + a[e].img + '" alt=""></div>';
						g += "<div>" + a[e].title + "</div>";
						g += '<div class="jqcart-price">' + a[e].price + "</div>";
						g += '<div><span class="jqcart-incr" data-incr="-1">&#8211;</span><input type="text" class="jqcart-amount" value="' + a[e].count + '"><span class="jqcart-incr" data-incr="1">+</span></div>';
						g += '<div class="jqcart-sum">' + k + " " + "$" + "</div>";
						g += '<div class="jqcart-small-td"><span class="jqcart-del-item"></span></div>';
						g += "</div>"
					}
				g += "</div></div>";
				g += '<div class="jqcart-subtotal">Total: <strong>' + b + "</strong> " + "$" + "</div>";
				b = b ? g + '<p class="jqcart-cart-title">Contact Information:</p><form class="jqcart-orderform"><p><label>Name:</label><input type="text" name="user_name"></p><p><label>Phone:</label><input type="text" name="user_phone"></p><p><label>Adress:</label><input type="text" name="user_address"></p><p><input type="submit" value="Order"><input type="reset" value="Back to shopping"></p></form>' : '<h2 class="jqcart-empty-cart">Cart is empty</h2>';
				d('<div class="jqcart-layout"><div class="jqcart-checkout" >123</div></div>').appendTo("body").find(".jqcart-checkout").html(b)
			},
			hideCart: function() {
				d(".jqcart-layout").fadeOut("fast", function() {
					d(this).remove()
				});
				return !1
			},
			sendOrder: function(b) {
				b.preventDefault();
				b = d(this);
				if ("" === d.trim(d("[name=user_name]", b).val()) || "" === d.trim(d("[name=user_phone]", b).val())) 
					return d('<p class="jqcart-error">Please indicate your contacts!</p>').insertBefore(b).delay(3E3).fadeOut(), !1;
				else {b.(hideCart());}
				d.ajax({
					url: h.handler,
					type: "POST",
					dataType: "json",
					data: {
						orderlist: d.param(c.getStorage()),
						userdata: b.serialize()

					},

					error: function() {},
					success: function(b) {
						d(".jqcart-checkout").html("<p>" + b.message + "</p>");
						b.errors || setTimeout(m.clearCart, 2E3)
					}
				})
			},
			setStorage: function(a) {
				localStorage.setItem("jqcart", JSON.stringify(a));
				return !1
			},
			getStorage: function() {
				return JSON.parse(localStorage.getItem("jqcart"))
			}
		},
		m = {
			
			openCart: c.openCart,
			printOrder: c.printOrder,
			test: function() {
				c.getStorage()
			}
		};
	d.jqCart = function(a) {
		if (m[a]) return m[a].apply(this, Array.prototype.slice.call(arguments, 1));
		if ("object" !== typeof a && a) d.error('\u041c\u0435\u0442\u043e\u0434 \u0441 \u0438\u043c\u0435\u043d\u0435\u043c "' + a + '" \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442!');
		else return c.init.apply(this, arguments)
	}
})(jQuery);